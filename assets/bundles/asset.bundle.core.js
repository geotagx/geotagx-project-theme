!function(t,e){var o,n;return n=e.document,o=function(){function o(o){var n;try{n=e.localStorage}catch(i){n=!1}this._options=t.extend({name:"tour",steps:[],container:"body",autoscroll:!0,keyboard:!0,storage:n,debug:!1,backdrop:!1,backdropPadding:0,redirect:!0,orphan:!1,duration:!1,delay:!1,basePath:"",template:'<div class="popover" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content"></div> <div class="popover-navigation"> <div class="btn-group"> <button class="btn btn-sm btn-default" data-role="prev">&laquo; Prev</button> <button class="btn btn-sm btn-default" data-role="next">Next &raquo;</button> <button class="btn btn-sm btn-default" data-role="pause-resume" data-pause-text="Pause" data-resume-text="Resume">Pause</button> </div> <button class="btn btn-sm btn-default" data-role="end">End tour</button> </div> </div>',afterSetState:function(){},afterGetState:function(){},afterRemoveState:function(){},onStart:function(){},onEnd:function(){},onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},onNext:function(){},onPrev:function(){},onPause:function(){},onResume:function(){}},o),this._force=!1,this._inited=!1,this.backdrop={overlay:null,$element:null,$background:null,backgroundShown:!1,overlayElementShown:!1}}return o.prototype.addSteps=function(t){var e,o,n;for(o=0,n=t.length;n>o;o++)e=t[o],this.addStep(e);return this},o.prototype.addStep=function(t){return this._options.steps.push(t),this},o.prototype.getStep=function(e){return null!=this._options.steps[e]?t.extend({id:"step-"+e,path:"",placement:"right",title:"",content:"<p></p>",next:e===this._options.steps.length-1?-1:e+1,prev:e-1,animation:!0,container:this._options.container,autoscroll:this._options.autoscroll,backdrop:this._options.backdrop,backdropPadding:this._options.backdropPadding,redirect:this._options.redirect,orphan:this._options.orphan,duration:this._options.duration,delay:this._options.delay,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume},this._options.steps[e]):void 0},o.prototype.init=function(t){return this._force=t,this.ended()?(this._debug("Tour ended, init prevented."),this):(this.setCurrentStep(),this._initMouseNavigation(),this._initKeyboardNavigation(),this._onResize(function(t){return function(){return t.showStep(t._current)}}(this)),null!==this._current&&this.showStep(this._current),this._inited=!0,this)},o.prototype.start=function(t){var e;return null==t&&(t=!1),this._inited||this.init(t),null===this._current&&(e=this._makePromise(null!=this._options.onStart?this._options.onStart(this):void 0),this._callOnPromiseDone(e,this.showStep,0)),this},o.prototype.next=function(){var t;return t=this.hideStep(this._current),this._callOnPromiseDone(t,this._showNextStep)},o.prototype.prev=function(){var t;return t=this.hideStep(this._current),this._callOnPromiseDone(t,this._showPrevStep)},o.prototype.goTo=function(t){var e;return e=this.hideStep(this._current),this._callOnPromiseDone(e,this.showStep,t)},o.prototype.end=function(){var o,i;return o=function(o){return function(){return t(n).off("click.tour-"+o._options.name),t(n).off("keyup.tour-"+o._options.name),t(e).off("resize.tour-"+o._options.name),o._setState("end","yes"),o._inited=!1,o._force=!1,o._clearTimer(),null!=o._options.onEnd?o._options.onEnd(o):void 0}}(this),i=this.hideStep(this._current),this._callOnPromiseDone(i,o)},o.prototype.ended=function(){return!this._force&&!!this._getState("end")},o.prototype.restart=function(){return this._removeState("current_step"),this._removeState("end"),this.start()},o.prototype.pause=function(){var t;return t=this.getStep(this._current),t&&t.duration?(this._paused=!0,this._duration-=(new Date).getTime()-this._start,e.clearTimeout(this._timer),this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining)."),null!=t.onPause?t.onPause(this,this._duration):void 0):this},o.prototype.resume=function(){var t;return t=this.getStep(this._current),t&&t.duration?(this._paused=!1,this._start=(new Date).getTime(),this._duration=this._duration||t.duration,this._timer=e.setTimeout(function(t){return function(){return t._isLast()?t.next():t.end()}}(this),this._duration),this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration),null!=t.onResume&&this._duration!==t.duration?t.onResume(this,this._duration):void 0):this},o.prototype.hideStep=function(e){var o,n,i;return(i=this.getStep(e))?(this._clearTimer(),n=this._makePromise(null!=i.onHide?i.onHide(this,e):void 0),o=function(o){return function(){var n;return n=t(i.element),n.data("bs.popover")||n.data("popover")||(n=t("body")),n.popover("destroy").removeClass("tour-"+o._options.name+"-element tour-"+o._options.name+"-"+e+"-element"),i.reflex&&n.removeClass("tour-step-element-reflex").off(""+o._reflexEvent(i.reflex)+".tour-"+o._options.name),i.backdrop&&o._hideBackdrop(),null!=i.onHidden?i.onHidden(o):void 0}}(this),this._callOnPromiseDone(n,o),n):void 0},o.prototype.showStep=function(t){var o,i,r,s;return this.ended()?(this._debug("Tour ended, showStep prevented."),this):(s=this.getStep(t))?(r=t<this._current,o=this._makePromise(null!=s.onShow?s.onShow(this,t):void 0),i=function(e){return function(){var o,i,a;if(e.setCurrentStep(t),i=function(){switch({}.toString.call(s.path)){case"[object Function]":return s.path();case"[object String]":return this._options.basePath+s.path;default:return s.path}}.call(e),o=[n.location.pathname,n.location.hash].join(""),e._isRedirect(i,o))return e._redirect(s,i),void 0;if(e._isOrphan(s)){if(!s.orphan)return e._debug("Skip the orphan step "+(e._current+1)+".\nOrphan option is false and the element does not exist or is hidden."),r?e._showPrevStep():e._showNextStep(),void 0;e._debug("Show the orphan step "+(e._current+1)+". Orphans option is true.")}return s.backdrop&&e._showBackdrop(e._isOrphan(s)?void 0:s.element),a=function(){return e.getCurrentStep()===t?(null!=s.element&&s.backdrop&&e._showOverlayElement(s),e._showPopover(s,t),null!=s.onShown&&s.onShown(e),e._debug("Step "+(e._current+1)+" of "+e._options.steps.length)):void 0},s.autoscroll?e._scrollIntoView(s.element,a):a(),s.duration?e.resume():void 0}}(this),s.delay?(this._debug("Wait "+s.delay+" milliseconds to show the step "+(this._current+1)),e.setTimeout(function(t){return function(){return t._callOnPromiseDone(o,i)}}(this),s.delay)):this._callOnPromiseDone(o,i),o):void 0},o.prototype.getCurrentStep=function(){return this._current},o.prototype.setCurrentStep=function(t){return null!=t?(this._current=t,this._setState("current_step",t)):(this._current=this._getState("current_step"),this._current=null===this._current?null:parseInt(this._current,10)),this},o.prototype._setState=function(t,e){var o,n;if(this._options.storage){n=""+this._options.name+"_"+t;try{this._options.storage.setItem(n,e)}catch(i){o=i,o.code===DOMException.QUOTA_EXCEEDED_ERR&&this._debug("LocalStorage quota exceeded. State storage failed.")}return this._options.afterSetState(n,e)}return null==this._state&&(this._state={}),this._state[t]=e},o.prototype._removeState=function(t){var e;return this._options.storage?(e=""+this._options.name+"_"+t,this._options.storage.removeItem(e),this._options.afterRemoveState(e)):null!=this._state?delete this._state[t]:void 0},o.prototype._getState=function(t){var e,o;return this._options.storage?(e=""+this._options.name+"_"+t,o=this._options.storage.getItem(e)):null!=this._state&&(o=this._state[t]),(void 0===o||"null"===o)&&(o=null),this._options.afterGetState(t,o),o},o.prototype._showNextStep=function(){var t,e,o;return o=this.getStep(this._current),e=function(t){return function(){return t.showStep(o.next)}}(this),t=this._makePromise(null!=o.onNext?o.onNext(this):void 0),this._callOnPromiseDone(t,e)},o.prototype._showPrevStep=function(){var t,e,o;return o=this.getStep(this._current),e=function(t){return function(){return t.showStep(o.prev)}}(this),t=this._makePromise(null!=o.onPrev?o.onPrev(this):void 0),this._callOnPromiseDone(t,e)},o.prototype._debug=function(t){return this._options.debug?e.console.log("Bootstrap Tour '"+this._options.name+"' | "+t):void 0},o.prototype._isRedirect=function(t,e){return null!=t&&""!==t&&("[object RegExp]"==={}.toString.call(t)&&!t.test(e)||"[object String]"==={}.toString.call(t)&&t.replace(/\?.*$/,"").replace(/\/?$/,"")!==e.replace(/\/?$/,""))},o.prototype._redirect=function(e,o){return t.isFunction(e.redirect)?e.redirect.call(this,o):e.redirect===!0?(this._debug("Redirect to "+o),n.location.href=o):void 0},o.prototype._isOrphan=function(e){return null==e.element||!t(e.element).length||t(e.element).is(":hidden")&&"http://www.w3.org/2000/svg"!==t(e.element)[0].namespaceURI},o.prototype._isLast=function(){return this._current<this._options.steps.length-1},o.prototype._showPopover=function(e,o){var n,i,r,s;return t(".tour-"+this._options.name).remove(),s=t.extend({},this._options),r=this._isOrphan(e),e.template=this._template(e,o),r&&(e.element="body",e.placement="top"),n=t(e.element),n.addClass("tour-"+this._options.name+"-element tour-"+this._options.name+"-"+o+"-element"),e.options&&t.extend(s,e.options),e.reflex&&!r&&(n.addClass("tour-step-element-reflex"),n.off(""+this._reflexEvent(e.reflex)+".tour-"+this._options.name),n.on(""+this._reflexEvent(e.reflex)+".tour-"+this._options.name,function(t){return function(){return t._isLast()?t.next():t.end()}}(this))),n.popover({placement:e.placement,trigger:"manual",title:e.title,content:e.content,html:!0,animation:e.animation,container:e.container,template:e.template,selector:e.element}).popover("show"),i=n.data("bs.popover")?n.data("bs.popover").tip():n.data("popover").tip(),i.attr("id",e.id),this._reposition(i,e),r?this._center(i):void 0},o.prototype._template=function(e,o){var n,i,r,s,a;return a=t.isFunction(e.template)?t(e.template(o,e)):t(e.template),n=a.find(".popover-navigation"),r=n.find('[data-role="prev"]'),i=n.find('[data-role="next"]'),s=n.find('[data-role="pause-resume"]'),this._isOrphan(e)&&a.addClass("orphan"),a.addClass("tour-"+this._options.name+" tour-"+this._options.name+"-"+o),e.prev<0&&r.addClass("disabled"),e.next<0&&i.addClass("disabled"),e.duration||s.remove(),a.clone().wrap("<div>").parent().html()},o.prototype._reflexEvent=function(t){return"[object Boolean]"==={}.toString.call(t)?"click":t},o.prototype._reposition=function(e,o){var i,r,s,a,p,u,h;if(a=e[0].offsetWidth,r=e[0].offsetHeight,h=e.offset(),p=h.left,u=h.top,i=t(n).outerHeight()-h.top-e.outerHeight(),0>i&&(h.top=h.top+i),s=t("html").outerWidth()-h.left-e.outerWidth(),0>s&&(h.left=h.left+s),h.top<0&&(h.top=0),h.left<0&&(h.left=0),e.offset(h),"bottom"===o.placement||"top"===o.placement){if(p!==h.left)return this._replaceArrow(e,2*(h.left-p),a,"left")}else if(u!==h.top)return this._replaceArrow(e,2*(h.top-u),r,"top")},o.prototype._center=function(o){return o.css("top",t(e).outerHeight()/2-o.outerHeight()/2)},o.prototype._replaceArrow=function(t,e,o,n){return t.find(".arrow").css(n,e?50*(1-e/o)+"%":"")},o.prototype._scrollIntoView=function(o,n){var i,r,s,a,p,u;return i=t(o),i.length?(r=t(e),a=i.offset().top,u=r.height(),p=Math.max(0,a-u/2),this._debug("Scroll into view. ScrollTop: "+p+". Element offset: "+a+". Window height: "+u+"."),s=0,t("body, html").stop(!0,!0).animate({scrollTop:Math.ceil(p)},function(t){return function(){return 2===++s?(n(),t._debug("Scroll into view.\nAnimation end element offset: "+i.offset().top+".\nWindow height: "+r.height()+".")):void 0}}(this))):n()},o.prototype._onResize=function(o,n){return t(e).on("resize.tour-"+this._options.name,function(){return clearTimeout(n),n=setTimeout(o,100)})},o.prototype._initMouseNavigation=function(){var e;return e=this,t(n).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']",function(t){return function(e){return e.preventDefault(),t.next()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']",function(t){return function(e){return e.preventDefault(),t.prev()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']",function(t){return function(e){return e.preventDefault(),t.end()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']",function(o){var n;return o.preventDefault(),n=t(this),n.text(e._paused?n.data("pause-text"):n.data("resume-text")),e._paused?e.resume():e.pause()})},o.prototype._initKeyboardNavigation=function(){return this._options.keyboard?t(n).on("keyup.tour-"+this._options.name,function(t){return function(e){if(e.which)switch(e.which){case 39:return e.preventDefault(),t._isLast()?t.next():t.end();case 37:if(e.preventDefault(),t._current>0)return t.prev();break;case 27:return e.preventDefault(),t.end()}}}(this)):void 0},o.prototype._makePromise=function(e){return e&&t.isFunction(e.then)?e:null},o.prototype._callOnPromiseDone=function(t,e,o){return t?t.then(function(t){return function(){return e.call(t,o)}}(this)):e.call(this,o)},o.prototype._showBackdrop=function(){return this.backdrop.backgroundShown?void 0:(this.backdrop=t("<div>",{"class":"tour-backdrop"}),this.backdrop.backgroundShown=!0,t("body").append(this.backdrop))},o.prototype._hideBackdrop=function(){return this._hideOverlayElement(),this._hideBackground()},o.prototype._hideBackground=function(){return this.backdrop?(this.backdrop.remove(),this.backdrop.overlay=null,this.backdrop.backgroundShown=!1):void 0},o.prototype._showOverlayElement=function(e){var o,n;return o=t(e.element),o&&0!==o.length&&!this.backdrop.overlayElementShown?(this.backdrop.overlayElementShown=!0,this.backdrop.$element=o.addClass("tour-step-backdrop"),this.backdrop.$background=t("<div>",{"class":"tour-step-background"}),n={width:o.innerWidth(),height:o.innerHeight(),offset:o.offset()},this.backdrop.$background.appendTo("body"),e.backdropPadding&&(n=this._applyBackdropPadding(e.backdropPadding,n)),this.backdrop.$background.width(n.width).height(n.height).offset(n.offset)):void 0},o.prototype._hideOverlayElement=function(){return this.backdrop.overlayElementShown?(this.backdrop.$element.removeClass("tour-step-backdrop"),this.backdrop.$background.remove(),this.backdrop.$element=null,this.backdrop.$background=null,this.backdrop.overlayElementShown=!1):void 0},o.prototype._applyBackdropPadding=function(t,e){return"object"==typeof t?(null==t.top&&(t.top=0),null==t.right&&(t.right=0),null==t.bottom&&(t.bottom=0),null==t.left&&(t.left=0),e.offset.top=e.offset.top-t.top,e.offset.left=e.offset.left-t.left,e.width=e.width+t.left+t.right,e.height=e.height+t.top+t.bottom):(e.offset.top=e.offset.top-t,e.offset.left=e.offset.left-t,e.width=e.width+2*t,e.height=e.height+2*t),e},o.prototype._clearTimer=function(){return e.clearTimeout(this._timer),this._timer=null,this._duration=null},o}(),e.Tour=o}(jQuery,window);
!function(a,b,c){"use strict";a.project=a.project||{}}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(){A.photoVisible=!0,b(".answer").each(function(){var a=b.trim(b(this).data("key"));a.length>0&&(A[a]=null)})}function e(){b.isEmptyObject(a.ol)||b(".geotagx-ol-map").each(function(){var c=b(this),d=b.trim(c.attr("id"));d.length>0&&a.ol.createMap(d,b.trim(c.data("location")))})}function f(){var a=b("#disqus_thread"),c=b("#questionnaire-show-comments"),d=b("#questionnaire-hide-comments");c.one("click.questionnaire",function(){var a="geotagx";!function(){var b=document.createElement("script");b.type="text/javascript",b.async=!0,b.src="//"+a+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(b)}()}).on("click.questionnaire",function(){b(this).fadeOut(100,function(){b(this).addClass("hide"),d.removeClass("hide").hide().fadeIn(150),a.removeClass("hide").hide().fadeIn(100)})}),d.on("click.questionnaire",function(){b(this).fadeOut(100,function(){b(this).addClass("hide"),c.removeClass("hide").hide().fadeIn(150),a.fadeOut(100,function(){b(this).addClass("hide")})})})}function g(){if(b.prototype.datetimepicker){var a=b(".datetime-picker");a.length>0&&a.datetimepicker({format:"YYYY/MM/DD HH:mm:ss",inline:!0,sideBySide:!0,icons:{up:"fa fa-2x fa-chevron-up",down:"fa fa-2x fa-chevron-down",next:"fa fa-chevron-right",previous:"fa fa-chevron-left"}});var c=b(".date-picker");c.length>0&&c.datetimepicker({format:"YYYY-MM-DD",inline:!0,icons:{next:"fa fa-chevron-right",previous:"fa fa-chevron-left"}})}}function h(){B=new a.Image("image"),b("#image-zoom-in").on("click.questionnaire",B.zoomIn.bind(B)),b("#image-zoom-out").on("click.questionnaire",B.zoomOut.bind(B)),b("#image-rotate-left").on("click.questionnaire",B.rotateLeft.bind(B)),b("#image-rotate-right").on("click.questionnaire",B.rotateRight.bind(B))}function i(a){var c=b(a.target),d=l(),e=q(u(d),c);r(d,e),I(d,e)}function j(){A.photoVisible=!1,z.finish()}function k(a){return"string"===b.type(a)&&b.trim(a).length>0&&("end"===a||a in A)}function l(){return F.length>0?F[F.length-1]:null}function m(a,c){var d=null;if(G&&a in G){var e=G[a],f=b.type(e);"string"===f?d=b.trim(e):"object"===f&&(c=b.trim(c.toLowerCase()),"binary"===u(a)&&(c="yes"===c?"yes":"no"),c in e&&(d=e[c]))}if(!k(d)){var g=t(a);g&&(d=g.next().data("key")||null)}return d||"end"}function n(){if(F.length>1){var c=l();p(c),r(c,null),F.pop();var d=l(),e=t(d);e&&e.length>0&&(H(d),e.removeClass("hide").hide().fadeIn(300)),1===F.length&&(b("#questionnaire-rewind").prop("disabled",!0),b("#questionnaire-no-photo").prop("disabled",!1),A.photoVisible=!0);var f=e.data("index");y(F.length>0?x(f-1):0),a.analytics.onQuestionChanged(f)}else console.log("[geotagx::questionnaire::showPreviousQuestion] Error! Could not load the previous question!")}function o(c){if(k(c)){var d=v(c),e=F.length>0;if(e&&p(l()),b("#questionnaire-rewind").prop("disabled",!e),b("#questionnaire-no-photo").prop("disabled",e),F.push(c),"end"===c)y(100);else if(s(c)){var f=t(c);f&&f.length>0&&(H(c),f.removeClass("hide").hide().fadeIn(300,function(){var c=f.data("type");if("geotagging"===c){var d=b(".geotagx-ol-map",f);if(d.length>0){var e=d.attr("id");if(e){var g=a.ol.findMap(e);g&&g.updateSize()}}}})),y(e?x(d-1):0)}a.analytics.onQuestionChanged(d)}else console.log("[geotagx::questionnaire::showQuestion] Error! Invalid question key '"+c+"'.")}function p(a){var b=t(a);b&&b.length>0&&b.addClass("hide")}function q(c,d){function e(a){var c="";if(a&&a.length>0){var d=b.trim(a.data("other-input-id"));if(d.length>0){var e=b("#"+d);if(e.length>0){var f=b.trim(e.val());c="Other"+(f.length>0?"["+f+"]":"")}}else c=b.trim(a.val())}return c}function f(a){var c="";return a.each(function(){var a=e(b(this));a.length>0&&(c+=", "+a)}),c.substring(2)}var g=d.attr("value");if("Done"!==g)return g;switch(c){case"dropdown-list":var h=b("#"+d.data("input-id")),i=b(":checked:not(:disabled)",h);return i.length>0?b.trim(i.val()):"None";case"select":var i=b("input:checked",d.siblings("label")),j=e(i);return j.length>0?j:"None";case"checklist":var k=b("input:checked",d.siblings("label")),j=f(k);return j.length>0?j:"None";case"illustrative-checklist":var l=b(".illustration",d.siblings(".illustrations")),h=b("input[type='checkbox']:checked",l),m=b.trim(b("input[type='text']",l).val());return m.length>0&&(m="Other["+m+"]"),g=m,g?0===h.length?g:g+", "+f(h):0===h.length?"None":f(h);case"geotagging":var n=null,o=d.data("target-id");if(o){var p=a.ol.findMap(o);p&&(n=p.getSelection())}return n;case"url":case"text":case"longtext":return b.trim(b("#"+d.data("input-id")).val());case"number":var q=b.trim(b("#"+d.data("input-id")).val());return q?parseFloat(q):null;case"datetime":var r=b("#"+d.data("input-id")).data("DateTimePicker").date();return null!==r?r.format("X"):null;case"date":var s=b("#"+d.data("input-id")).data("DateTimePicker").date();return null!==s?s.format("YYYY-MM-DD"):null;default:return console.log("[geotagx::questionnaire::parseAnswer] Error! Unknown question type '"+c+"'."),null}}function r(a,c){k(a)&&"end"!==a&&(A[a]="undefined"===b.type(c)?null:c)}function s(a){return a in A}function t(a){return s(a)?b(".question[data-key='"+a+"']"):null}function u(a){return"end"===a?null:t(a).data("type")}function v(a){return"end"===a?-1:t(a).data("index")}function w(){b("textarea").val(""),b("input").removeAttr("checked"),b("input[type='text']").val(""),b("input[type='url']").val(""),b("input[type='number']").val(""),b("select > option:eq(0)").prop("selected",!0),b([".datetime-picker",".date-picker"]).each(function(){var a=b(this);a.length>0&&a.data("DateTimePicker")&&a.data("DateTimePicker").clear()}),a.ol&&a.ol.resetAllMaps&&a.ol.resetAllMaps()}function x(a){return Math.max(0,Math.min(100,(a/D*100).toFixed(0)))}function y(a){100===a?(b("#current-analysis-progress").html(100),b("#questionnaire-progress-bar").css("width","100%"),b("#questionnaire-status-panel").addClass("analysis-complete")):(b("#current-analysis-progress").html(a),b("#questionnaire-progress-bar").css("width",a+"%"),b("#questionnaire-status-panel").removeClass("analysis-complete"))}var z={},A={},B=null,C=null,D=0,E=null,F=[],G=null,H=function(){};b(document).ready(function(){C=b(".question"),D=C.length,E=C.first().data("key"),d(),e(),f(),g(),h(),b(".btn-answer").on("click.questionnaire",i),b("#questionnaire-no-photo").on("click",j),b("#questionnaire-rewind").on("click",n)});var I=function(a,b){o(m(a,b))};z.start=function(c){C.addClass("hide"),w(),F=[],b("#questionnaire-show-comments").prop("disabled",!1);for(var d in A)A[d]=null;k(c)&&(E=c),z.showQuestion(E),a.tour.questionnaireTourEnded()||setTimeout(a.tour.startQuestionnaireTour,1e3)},z.finish=function(){z.showQuestion("end")},z.setControlFlow=function(a){G=a},z.setImage=function(a,c){B.setSource(a),b("#image-source").attr("href",c)},z.getNextQuestionKey=function(a,c){return m(b.trim(a),c)},z.getNumberOfQuestions=function(){return D},z.getQuestionType=function(a){return u(b.trim(a))},z.getAnswer=function(a){var b=null;return s(a)?b=A[a]:console.log("[geotagx::questionnaire::getAnswer] Warning! Could not find a storage key for the question with the key '"+a+"'."),b},z.getAnswers=function(){return A},z.getCurrentQuestionKey=l,z.onShowNextQuestion=function(a){a&&"function"===b.type(a)&&(I=a)},z.showPreviousQuestion=n,z.showQuestion=function(a){o(b.trim(a))},z.showNextQuestion=function(a,c){I(b.trim(a),c)},z.onBeforeShowQuestion=function(a){H="function"===b.type(a)?a:function(){}},a.questionnaire=z}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(a,b){var c=window.getComputedStyle(a,null);b.w=parseInt(c.width,10),b.h=parseInt(c.height,10),b.bgw=b.w,b.bgh=b.h,b.x=0,b.y=0,a.style.width="100%",a.style.height="100%",a.style.backgroundImage='url("'+a.src+'")',a.style.backgroundRepeat="no-repeat",a.style.backgroundSize="100% 100%",a.style.backgroundPosition="0 0",a.src=e(a.naturalWidth,a.naturalHeight)}function e(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.toDataURL()}function f(a,b){b.x>0?b.x=0:b.x<b.w-b.bgw&&(b.x=b.w-b.bgw),b.y>0?b.y=0:b.y<b.h-b.bgh&&(b.y=b.h-b.bgh),a.style.backgroundSize=b.bgw+"px "+b.bgh+"px",a.style.backgroundPosition=b.x+"px "+b.y+"px"}function g(a,c,d,e,g){var h=a.attributes,i=e-h.x,j=g-h.y,k=i/h.bgw,l=j/h.bgh;0>c?(h.bgw+=h.bgw*d,h.bgh+=h.bgh*d):(h.bgw-=h.bgw*d,h.bgh-=h.bgh*d),h.x=e-h.bgw*k,h.y=g-h.bgh*l,h.bgw<=h.w||h.bgh<=h.h?(h.x=0,h.y=0,h.bgw=h.w,h.bgh=h.h):b(image).trigger("zoom",0>c?-1:1),f(a.image,h)}function h(a){a.preventDefault();var b=a.deltaY?a.deltaY:a.wheelDelta?-a.wheelDelta:0,c=this.image.getBoundingClientRect(),d=a.pageX-c.left-document.body.scrollLeft,e=a.pageY-c.top-document.body.scrollTop;switch(this.image.rotation){case 90:var f=d;d=e/c.height*c.width,e=c.height-f/c.width*c.height;break;case 180:d=c.width-d,e=c.height-e;break;case 270:var f=d;d=c.width-e/c.height*c.width,e=f/c.width*c.height}g(this,b,this.settings.zoomFactor,d,e)}function i(a){function b(a){var b=a.pageX-e.e.pageX,c=a.pageY-e.e.pageY;switch(e.e=a,a.preventDefault(),d.rotation){case 90:e.x+=c,e.y-=b;break;case 180:e.x-=b,e.y-=c;break;case 270:e.x-=c,e.y+=b;break;default:e.x+=b,e.y+=c}f(d,e)}function c(){document.removeEventListener("mouseup",c),document.removeEventListener("mousemove",b)}a.preventDefault();var d=this.image,e=this.attributes;e.e=a,document.addEventListener("mousemove",b),document.addEventListener("mouseup",c)}function j(a,b){b=(360+b)%360;var c=a.frame,d=a.image,e=90===b||270===b?1/d.aspectRatio:d.aspectRatio,f=c.offsetWidth,g=f/e;c.style.height=g+"px",f=c.offsetWidth;var h=1,i=1;e!==d.aspectRatio&&(h=g/f,i=f/g),d.rotation=b,d.style.transform=d.style.oTransform=d.style.msTransform=d.style.mozTransform=d.style.webkitTransform="rotate("+d.rotation+"deg) scale("+h+", "+i+")";var j=window.getComputedStyle(d,null);a.attributes.w=parseInt(j.width,10),a.attributes.h=parseInt(j.height,10),k.prototype.zoomReset.call(a)}var k=function(a,c){this.frame=document.getElementById(a),this.frame.style.overflow="hidden",this.frame.style.backgroundColor="rgba(0, 0, 0, 0.25)",this.busyIcon=this.frame.appendChild(document.createElement("i")),this.busyIcon.className="fa fa-3x fa-cog fa-spin",this.busyIcon.style.color="#FFF",this.busyIcon.style.position="absolute",this.busyIcon.style.display="none",this.image=this.frame.appendChild(document.createElement("img")),this.image.addEventListener("wheel",h.bind(this)),this.image.addEventListener("mousedown",i.bind(this)),this.image.aspectRatio=0,this.image.rotation=0,this.settings=b.extend({zoomFactor:.15,discreetZoomFactor:.45},c),this.attributes={x:0,y:0,w:0,h:0,bgw:0,bgh:0,e:null}};k.prototype.getSource=function(){return b(this.image).data("src")},k.prototype.setSource=function(a){if("string"===b.type(a)){var c=this;b(c.image).fadeOut(100,function(){if(b(c.image).data("src")==a)k.prototype.zoomReset.call(c),b(c.image).fadeIn();else{c.busyIcon.style.display="block",b(c.image).attr("src",a).data("src",a);var e=setInterval(function(){if(c.image.complete){clearInterval(e),c.image.aspectRatio=c.image.naturalWidth/c.image.naturalHeight;var a=c.frame.offsetWidth,f=Math.ceil(a/c.image.aspectRatio),g=.5*(a-c.busyIcon.offsetWidth),h=.5*(f-c.busyIcon.offsetHeight);c.busyIcon.style.display="none",b(c.image).fadeIn(0,function(){c.frame.style.height=f+"px",c.busyIcon.style.left=g+"px",c.busyIcon.style.top=h+"px",d(c.image,c.attributes),j(c,0)})}},300)}})}},k.prototype.zoomIn=function(){var a=this.image.width/2,b=this.image.height/2;g(this,-1,this.settings.discreetZoomFactor,a,b)},k.prototype.zoomOut=function(){var a=this.image.width/2,b=this.image.height/2;g(this,1,this.settings.discreetZoomFactor,a,b)},k.prototype.zoomReset=function(){this.attributes.x=0,this.attributes.y=0,this.attributes.bgw=this.attributes.w,this.attributes.bgh=this.attributes.h,f(this.image,this.attributes)},k.prototype.rotateLeft=function(){j(this,this.image.rotation-90)},k.prototype.rotateRight=function(){j(this,this.image.rotation+90)},a.Image=k}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(){var b=function(a){return".question[data-key='"+a+"'] > "},c=this.element,d=this.currentQuestionKey,e=a.questionnaire.getCurrentQuestionKey();e!==d&&("string"==typeof d&&(c=c.substring(b(d).length)),this.element=b(e)+c,this.currentQuestionKey=e)}var e={},f=null;e.questionnaireTourEnded=function(){return"yes"===localStorage.getItem("geotagx_questionnaire_tour_end")},e.startQuestionnaireTour=function(){f||(f=new Tour({name:"geotagx_questionnaire_tour",orphan:!0,steps:[{orphan:!0,title:"Welcome!",content:"It seems as though you are new around here. How about we take a tour?<br><small>Note: You can navigate faster by using the <kbd>&#8592;</kbd> and <kbd>&#8594;</kbd> arrow keys.</small>"},{element:"#questionnaire-status-panel",placement:"bottom",title:"The Status Panel",content:"This section provides feedback as you progress through the questionnaire."},{element:"#image-section",placement:"top",title:"The Image",content:"You will be tasked with analysing an image. When you complete an analysis, a new image will be presented to you."},{element:".answer button[value='NotClear']",onShow:d,placement:"bottom",title:"Image not clear enough",content:"Certain factors may limit how much information you can take away from an image. For instance, it is almost impossible to deduce the color of the sky from a black and white photo, or discern a person's facial features from a blurry photo. Select this if you can not answer a question based on what you see in the image."},{element:".title",onShow:d,placement:"bottom",title:"The Question",content:"This is one of many questions asked about the image to the right. Try to answer it to the best of your capabilities ..."},{element:".help-toggle",onShow:d,placement:"bottom",title:"Help!",content:"... but remember, if you are having trouble answering a question, take a look at the help ..."},{element:"#image-source",placement:"left",title:"Image source",content:"... and the image source. More often than not, the source will give you contextual information that may prove to be invaluable."},{element:".answer button[value='Unknown']",onShow:d,placement:"bottom",title:"You're only human",content:"Sometimes a question may prove challenging. If you can not answer it, your best bet is to select this answer."}]}),f.init()),localStorage.setItem("geotagx_questionnaire_tour_current_step",0),f.start(!0)},a.tour=e}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(a,b){z.push({name:a,data:b})}function e(a){var c={projectId:w,questionId:y,taskId:v,buttonValue:b(a.target).val()};analytics.fireEvent("action.answerQuestion",c)}function f(){var a={projectId:w,questionId:x};analytics.fireEvent("action.tutorialImageZoom",a)}function g(){var a={projectId:w,questionId:x,taskId:v};analytics.fireEvent("action.imageZoom",a)}function h(){var a={projectId:w,questionId:x};analytics.fireEvent("action.showTutorialImageSource",a)}function i(){var a={projectId:w,questionId:x,taskId:v};analytics.fireEvent("action.showImageSource",a)}function j(){var a={projectId:w,imageUrl:b("#image > img").data("src"),imageSource:b("#image-source").attr("href")};analytics.fireEvent("action.noTutorialImage",a)}function k(){var a={projectId:w,imageUrl:b("#image > img").data("src"),imageSource:b("#image-source").attr("href")};analytics.fireEvent("action.noImage",a)}function l(){var a={projectId:w,questionId:y};analytics.fireEvent("action.showPreviousTutorialQuestion",a)}function m(){var a={projectId:w,questionId:y,taskId:v};analytics.fireEvent("action.showPreviousQuestion",a)}function n(){var a={projectId:w,questionId:x};analytics.fireEvent("action.showTutorialComments",a)}function o(){var a={projectId:w,questionId:x,taskId:v};analytics.fireEvent("action.showComments",a)}function p(){var a={projectId:w,questionId:x};analytics.fireEvent("action.showTutorialHelp",a)}function q(){var a={projectId:w,questionId:x,taskId:v};analytics.fireEvent("action.showHelp",a)}function r(){var a={projectId:w,taskId:v};analytics.fireEvent("action.submitTask",a)}function s(){var a={projectId:w};d("action.skipTutorial",a)}function t(){var a={projectId:w};analytics.fireEvent("action.completeTutorial",a)}var u={},v=0,w=null,x=null,y=null,z=[];b(document).on("geotagx-analytics-disabled",function(){d=function(a,b){}}),b(document).on("geotagx-analytics-configured",function(){d=analytics.fireEvent.bind(analytics);for(var a=0;a<z.length;++a){var c=z[a];analytics.fireEvent(c.name,c.data)}z.length=0,b("#project-task-presenter.analysis .btn-answer").on("click.analytics",e),b("#project-task-presenter.tutorial #image").on("zoom.analytics",_debounce(f,350)),b("#project-task-presenter.analysis #image").on("zoom.analytics",_debounce(g,350)),b("#project-task-presenter.tutorial #image-source").on("click.analytics",h),b("#project-task-presenter.analysis #image-source").on("click.analytics",i),b("#project-task-presenter.tutorial #questionnaire-no-photo").on("click.analytics",j),b("#project-task-presenter.analysis #questionnaire-no-photo").on("click.analytics",k),b("#project-task-presenter.tutorial #questionnaire-rewind").on("click.analytics",l),b("#project-task-presenter.analysis #questionnaire-rewind").on("click.analytics",m),b("#project-task-presenter.tutorial #questionnaire-show-comments").on("click.analytics",n),b("#project-task-presenter.analysis #questionnaire-show-comments").on("click.analytics",o),b("#project-task-presenter.tutorial .help-toggle").on("click.analytics",p),b("#project-task-presenter.analysis .help-toggle").on("click.analytics",q),b("#submit-analysis").on("click.analytics",r),b("#skip-tutorial").on("click.analytics",s),b("#start-contributing").on("click.analytics",t)}),u.onTaskChanged=function(a){v=a;var b={projectId:w,taskId:v};analytics.fireEvent("action.startTask",b)},u.onQuestionChanged=function(a){y=null===x?a:x,x=a},u.onCorrectTutorialAnswer=function(){var a={projectId:w,questionId:x};analytics.fireEvent("action.correctTutorialAnswer",a)},u.onWrongTutorialAnswer=function(){var a={projectId:w,questionId:x};analytics.fireEvent("action.wrongTutorialAnswer",a)},u.onStartProject=function(a){w=a;var b={projectId:w};d("action.startProject",b)},u.onStartTutorial=function(a){w=a;var b={projectId:w};d("action.startTutorial",b)},a.analytics=u}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(a,c){b.isEmptyObject(a)?c.resolve(a):(a.photoAccessible=!0,b("<img>").load(function(){c.resolve(a)}).error(function(b){a.photoAccessible=!1,c.resolve(a)}).attr("src",a.info.image_url))}function e(c,d){b.isEmptyObject(c)?(b("#participation-appreciation-section").removeClass("hide"),b("#questionnaire-section").addClass("hide"),b("#image-section").addClass("hide"),b("#project-task-presenter-header").addClass("hide")):c.photoAccessible?(b(".show-on-task-loaded").removeClass("show-on-task-loaded").hide().fadeIn(200),b(".hide-on-task-loaded").hide(),pybossa.userProgress(g).done(function(a){b("#project-task-count").text(a.done+"/"+a.total)}),a.questionnaire.setImage(c.info.image_url,c.info.source_uri),b("#submit-analysis").off("click.task").on("click.task",function(){var a=b("#submit-analysis"),e=b("#questionnaire-busy-icon");e.removeClass("hide").hide().fadeIn(300),a.toggleClass("busy btn-success"),a.prop("disabled",!0),f(c,d)}),a.analytics.onTaskChanged(c.id),a.questionnaire.start()):f(c,d)}function f(c,d){function e(){d.resolve()}var f=a.questionnaire.getAnswers();if(f.img=c.info.image_url,f.photoAccessible=c.photoAccessible,f.photoVisible=f.photoAccessible&&f.photoVisible,c.photoAccessible===!1)pybossa.saveTask(c.id,f).done(e).fail(e);else if(c.photoAccessible===!0){var g=b("#submit-analysis"),h=b("#questionnaire-busy-icon");pybossa.saveTask(c.id,f).done(function(){h.fadeOut(300,function(){b(this).addClass("hide")});var a=b("#submit-message-success");a.removeClass("hide"),setTimeout(function(){d.resolve(),a.addClass("hide"),g.toggleClass("busy btn-success"),g.prop("disabled",!1)},1500)}).fail(function(a){h.fadeOut(300,function(){b(this).addClass("hide")}),g.toggleClass("busy btn-success"),g.prop("disabled",!1);var c=b("#submit-message-failure");403===a.status?(d.resolve(),c.addClass("hide")):(c.removeClass("hide"),g.one("click",function(){c.addClass("hide")}))})}}var g,h={};h.start=function(c,f,h,i){return"string"!==b.type(c)?void console.log("[geotagx::pybossa::start] Error! Invalid project slug."):(g=c,a.questionnaire.setControlFlow(f),void(h?(a.tutorial.start(c,i),a.analytics.onStartTutorial(g)):(pybossa.taskLoaded(d),pybossa.presentTask(e),pybossa.run(g),a.analytics.onStartProject(g))))},h.getShortName=function(){return g},a.pybossa=h}(window.geotagx=window.geotagx||{},jQuery),function(a,b,c){"use strict";function d(b){a.questionnaire.setImage(b.image,b.image_source),m=b.assertions}function e(b,c){for(var d=a.questionnaire.getNextQuestionKey(b,c),e=m[d];e&&e.skip;)d=a.questionnaire.getNextQuestionKey(d,"Unknown"),e=m[d];return d}function f(a){var c=m[a];if(c){var d=c.autocomplete;if(d){var e=".question[data-key='"+a+"'] .answer ",f=b(e+"input");if(f.length>0){f.val(c.expects),f.prop("disabled",!0);var g=b(".question[data-key='"+a+"'] .answer button.btn-answer[value='Done']");g.length>0&&g.trigger("click")}}}}function g(c,d,f){var g=m[c],i=g.default_message,j=!1;if("string"===b.type(d)){j=d.toLowerCase()===g.expects.toLowerCase();var k=g.messages;i=k[d]||k[d.toLowerCase()]||k[d.toUpperCase()]||i}else j=d===g.expects;j?(n=e(c,d),a.analytics.onCorrectTutorialAnswer()):a.analytics.onWrongTutorialAnswer(),h(i,j)}function h(a,c){var d=b("#tutorial-message-box");d.removeClass("hide").hide(),c?(d.addClass("expected"),b("#tutorial-success-message").html(a)):(d.removeClass("expected"),b("#tutorial-failure-message").html(a)),d.fadeIn(250)}function i(a){b("#tutorial-message-box").fadeOut(150,function(){b(this).addClass("hide"),a&&"function"===b.type(a)&&a()})}var j={},k=0,l=0,m=null,n=0;j.start=function(c,e){return"string"!==b.type(c)?void console.log("[geotagx::project::start] Error! Invalid project slug."):(b(".show-on-task-loaded").removeClass("show-on-task-loaded").hide().fadeIn(200),b(".hide-on-task-loaded").hide(),b("#questionnaire-rewind").on("click.tutorial",i),b("#tutorial-next-question").on("click.tutorial",function(){i(function(){a.questionnaire.showQuestion(n)})}),b("#take-another-tutorial").on("click.tutorial",function(){l=(l+1)%k,d(e[l]),a.questionnaire.start()}),k=e.length,l=Math.floor(Math.random()*k),d(e[l]),a.questionnaire.onBeforeShowQuestion(f),a.questionnaire.onShowNextQuestion(g),void a.questionnaire.start())},a.tutorial=j}(window.geotagx=window.geotagx||{},jQuery);